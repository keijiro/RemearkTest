<!DOCTYPE html>
<html>
  <head>
    <title>24 URP Corssfading</title>
    <meta charset="utf-8">
    <style>
      .remark-slide-content {
        color: white;
        background-color: black;
        font-size: 50pt;
        padding: 0px 0.5em;
      }
      .remark-code-line { font-size: 30pt; margin: 0.2em 0px; }
      p { margin: 0.5em 0px; line-height: 120%; }
      code { margin: 0px 2em; }
    </style>
  </head>
  <body>
<textarea id="source">

みなさんこんにちは。

今回のトピックは、URP の新機能、LOD クロスフェーディングです。

---

Unity 2022.2 に搭載されている URP 14.0 では、新機能として LOD Group のクロスフェーディングに対応しています。

---

> GIF

LOD のクロスフェーディングっていうのは、まあ要するにこういうやつですね。

---

LOD モデルの切り替えをクロスフェーディングによって滑らかにするという機能です。

---

左のように、単純に切り替えると、どうしても切り替えの瞬間がバレてしまうんですよね。

右のように、クロスフェーディングを使えば、切り替えを滑らかに繋いで、目立たなくすることができます。

---

まあこれは分かりやすくするために作った極端な例なんですが…

> GIF 2

ちゃんと真面目に設定するとこんな感じになります。

---

単純な切り替えでは、どうしても切り替わった瞬間が分かってしまいますよね。

クロスフェーディングを使えば、これをかなり隠せる、ということが分かると思います。

---

> Editor

LOD クロスフェーディングは、特別な設定を行わなくても、もう URP 上で使えるようになっています。

---

LOD Group の設定で Fade Mode を Cross Fade に変更するだけで OK です。

---

> Camera

クロスフェーディングの制御には２つの方式が用意されています。

一つは時間によってフェーディングする方式、もう一つは距離によってフェーディングする方式です。

---

> Editor

この "Animate Cross-fading" をオンにすると、時間によるフェーディングになります。

---

LOD モデルが切り替わってから一定時間をかけてフェーディングしていく、というものですね。

---

> B-Roll

ちなみにこのフェーディングにかける時間は crossFadeAnimationDuration という変数を使ってスクリプトから変更することもできます。

---

デフォルト値は 0.5 秒に設定されていますね。

---

> Editor

もうひとつの距離を使う方式は、この Fade Transition Width というパラメーターで設定できます。

---

これは、隣接する２つの LOD がどの程度オーバーラップしているかを表す数値です。

例えばこれを 0.1 に設定したら、このバーの１割ぐらい…この辺りまでオーバーラップしていることになりますかね。

---

> Camera

この２つの方式のどちらを使うべきかって問題がありますが、個人的には、見た目の自然さを気にするなら距離方式、パフォーマンスを気にするなら時間方式かなと思っています。

---

クロスフェーディングって、モデルを２回描画しているので、要するに描画負荷は約２倍になっているんですよね。

---

なので、できるだけ早くフェーディングが終わって欲しいという事情があります。

時間方式は、一定時間内に必ずクロスフェーディングが終わるので、その点、安心感があります。

---

でも、時間方式だと、カメラがピタって止まっているときに、LOD モデルがじんわりと変形しているのがバレてしまうことがあるんですよね。

そういうのを気にする場合は距離方式の方がいいのかなと思います。

---

LOD クロスフェーディングの使い方は、まあだいたいこんな感じですね。

あと、URP には LOD クロスフェーディングに関するオプションが少しだけ用意されています。

---

> Desktop

この Quality のところに、LOD Cross Fade というスイッチがありますね。

これは通常オンにしておいてください。

---

それで、もうひとつ、Dithering Type というオプションがあります。

これはクロスフェーディングのディザリングの方式を設定するものですね。

"Bayer Matrix" と "Blue Noise" の２種類が用意されています。

---

LOD クロスフェーディングでは、アルファブレンディングのような半透明描画ではなくて、ディザリングを使った重ね描きが使用されます。

網目状のパターンを使って向こう側を透けさせるテクニックですね。

---

> GIF

Bayer Matrix は古典的なディザリング方式です。

細かいパターンをリピートして使っているのが分かりますね。

---

それに対して Blue Noise はノイズパターンを使ったディザリング方式です。

より自然な感じでディザリングすることができます。

---

> B-Roll

ドキュメントには、Blue Noise の方は負荷が比較的高いよと書かれているんですが、まあ個人的には気にしなくていいレベルかなと思います。

---

ちっちゃいノイズテクスチャを高々１回サンプリングする程度の違いですからね。

---

もう一点、シェーダーグラフを使った場合のクロスフェーディング対応にも触れておきましょう。

---

このクロスフェーディングは URP の標準シェーダーならデフォルトで対応しているんですが、カスタムシェーダーの場合は手動で有効化する必要があります。

---

> Editor 

"Graph Settings" の、ここに "Supports LOD Cross Fade" というスイッチがあるんですが、これをオンにするだけですね。

これで OK です。

---

今回はこんな感じで LOD クロスフェーディングについて解説しましたが、いかがでしたでしょうか？

---

まあクロスフェーディング以前のね、そもそも LOD をどうやってオーサリングするのかって話があるんですが、それはまた別の機会に触れましょう。

今回はあくまでも URP の新機能ということで簡単に紹介してみました。

---

今回の動画が参考になったという方は高評価やコメントを頂けると有難いです。

それではまた次回の動画でお会いしましょう。

</textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        ratio: '16:9',
        highlightStyle: 'sunburst',
        slideNumberFormat: ''
      });
    </script>
  </body>
</html>
