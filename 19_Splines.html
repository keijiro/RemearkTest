<!DOCTYPE html>
<html>
  <head>
    <title>19 Spline</title>
    <meta charset="utf-8">
    <style>
      .remark-slide-content {
        color: white;
        background-color: black;
        font-size: 32pt;
        padding: 0px 0.5em;
      }
      .remark-code-line { font-size: 22pt; margin: 0.2em 0px; }
      p { margin: 0.5em 0px; line-height: 120%; }
      code { margin: 0px 2em; }
    </style>
  </head>
  <body>
<textarea id="source">

みなさんこんにちは。

今回のトピックは、Unity の新機能、スプラインツールです。

---

Unity のスプラインツールは Unity 2022.1 において追加された新機能の一つです。

名前の通りスプラインカーブを編集するためのエディタなんですが、以前から標準機能として搭載して欲しいというリクエストが多く寄せられていたんですよね。

これがようやく公式パッケージとして提供されることなった、という格好です。

---

なにはともあれ、まずはパッケージをインストールしてみましょうか。

> Switch to desktop

Package Manager から "Splines" を選択して Install ボタンを押します。

---

スプラインツールを初めて使うという方は、同時にこのサンプルプロジェクトもインポートしておくことをお勧めします。

スプラインを使うとこんな事ができる、というのが分かりやすくまとまっています。

---

> Back to camera

それでは、このスプラインツールを使うと何ができるのか、というのを簡単に解説していきましょう。

まずひとつ目は、スプラインの編集です。

> Title:「その１・スプラインの編集」

まあ、これは当たり前ですね。

さっそく編集してみましょう。

---

> Switch to desktop

まず、空のゲームオブジェクトを作って、 Spline コンポーネントを追加します。

すると、シーンビューのツールバースプラインツールが呼び出せるようになります。

これを押して、スプラインモードに移行しましょう。

---

まずは点を適当に置いていきましょうか。

ポンポンポンと……

こうやって重ねてクリックすれば、閉じたスプラインにできます。

---

こうして作った折れ線をカーブにするには、スプライン・インスペクターを使うんですが、もしかしたら、こんな感じでインスペクターがツールバーの中に引っ込んじゃってるかもしれません。

こういう場合は、ドラッグして引き出してあげた方が作業しやすいですね。

このインスペクターを使って、カーブを均等に曲げたり、偏って曲げたり、あるいは折り曲げたり、リニアに戻したり、とか、そういう一般的な操作ができます。

---

> Back to camera

次に行きましょう。

スプラインツールを使ってできること、その２は、スプラインのメッシュ化です。

> Title:「その２・スプラインのメッシュ化」

スプラインを Mesh Renderer を使って描画できるようにする、という機能です。

---

> Switch to desktop

先ほど作ったスプラインと同じゲームオブジェクトに Spline Extrude コンポーネントを追加しましょう。

これでスプラインがチューブ状のメッシュオブジェクトになりました。

太さを変えたり、細かさを変えたり、範囲を変えたり、基本的なパラメーターが用意されています。

まああとはマテリアルをちゃんと設定すれば、見た目を作り込むこともできますね。

---

> Back to camera

スプラインツールを使ってできること、その３は、スプラインに沿ってオブジェクトを動かすという機能です。

> Title:「その３・スプラインに沿って動かす」

スプラインカーブを使った簡単なアニメーション、といったところですね。

---

> Switch to desktop

先ほどのシーンにキューブを追加して、これをこのスプラインに沿って動かしてみましょう。

キューブのゲームオブジェクトに Spline Animate を追加します。

Spline に先ほどのスプラインを追加して再生すると……スプラインに沿ってキューブが動き始めました。

---

１周するのにかける時間を指定したり、あるいは速度で速さを設定できたりします。

あと、ここにあるのはイージングやループの有無の設定ですね。

この辺りの設定については、サンプルプロジェクトの Animate Component の中にまとまっています。

ちょっと見てみましょうか。

---

こんな感じで、単純に連続再生したり、初めと終わりをイージングしたり、初めと終わりを行ったり来たりのピンポン再生したり、というようなオプションが用意されています。

---

> Back to camera

スプラインツールを使ってできること、その４は、スプラインに沿ってオブジェクトを配置するという機能です。

> Title:「その４・スプラインに沿ったオブジェクト配置」

これが一番面白い機能かもしれませんね。

---

> Switch to desktop

先ほどのシーンで、まずは配置するための適当なプレハブを用意しましょうか。

まあ今回はこの適当に作ったキューブを使いましょう。

---

ゲームオブジェクトを作って、Spline Instantiate を追加します。

Container に先ほどのスプラインを指定して、Items To Instantiate にプレハブを登録すると……こんな感じでスプラインに沿ってオブジェクトが配置されました。

配置の間隔を調整したり、オフセットをかけたり、ランダムにしたり、とか色んなパラメーターが用意されています。

---

この機能については分かりやすいサンプルが用意されているので、ぜひこっちを見てみてください。

この "Instantiate Component" ってヤツですね。

こんな感じで、カーブに沿ってオブジェクトを自然に配置することができます。

---

この柵は、等間隔に配置しつつランダムな Z 回転で少し揺らぎを持たせてますね。

この石畳は間隔と回転をランタムにしています。

この木は、複数のプレハブを登録することでバリエーションを増やしてますね。

これらのオプションを組み合わせることで、この環境がデザインされています。

---

> Back to camera

スプラインの標準機能を使ってできることは以上ですが、スクリプトと組み合わせればもっと色々な使い方ができます。

これについてはサンプルプログラムを参考にすると分かりやすいかもしれませんね。

---

> Desktop: 1 - Loft Road

こんな感じで、平面のメッシュを作ることで道路をデザインしたり……

> Desktop: 5 - SplineData and Generation

これはスプラインデータを拡張して、速度パラメータのエディットをできるようにしたものですね。

---

> Desktop: 7 - Nearest Point

曲線状の近傍点を求めたり……

> Desktop: 8 - Curvature

曲率を求めたりといった基本的な数学 API も、もちろん用意されています。

---

こんな感じで今回は Unity の新機能であるスプラインツールについて紹介してきましたが、いかがでしたでしょうか。

やっぱりあのオブジェクトを配置する機能とかは今すぐにでも使えそうで面白いですよね。

---

今回は標準コンポーネントを中心に解説しましたが、独自のスクリプトでカスタマイズした使い方についても、また別の機会にお話ししたいですね。

もし、こういう使い方ができたらいいんじゃないか、とか、こういう使い方をするにはどうしたらいいか教えて、みたいな質問がありましたら、コメント欄に書き込んでみてください。

---

また今回の動画が参考になったという方は高評価やコメントを頂けますと有難いです。

それではまた次回の動画でお会いしましょう。

</textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        ratio: '16:9',
        highlightStyle: 'sunburst',
        slideNumberFormat: ''
      });
    </script>
  </body>
</html>
